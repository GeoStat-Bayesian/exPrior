---
title: "Using exPrior with multiple types of data"
author: "Falk HeÃŸe"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Multi-type data}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, echo=FALSE}
knitr::opts_chunk$set(fig.width = 7, fig.height = 5)
```

The `exPrior` package is written in a flexible manner, such that it can assimilate data that come in the form of measurements, bounds, or moments. To exemplify this flexibility, let us use in this example synthetic data from three sites called S1, S2, and S3. From Site S1 we have data in the form of bounds, where the minimum value of a property of S1 is 2, and its maximum value is 4. 
Site S2 has data in the form of moments, where the first moment, or site mean, is 2, while the second moment, or site variance, is 0.1. Finally, site S3 has three measurements. The code below shows how to format the data in R such that it can be read into `genExPrior()`.

```{r}
library(devtools)
load_all()
library(exPrior)
```

Under the assumption that the site specific parameter follows a normal distribution, the function `genExPrior` takes in three parameters. First, `exdata` is a data frame where the first column contains the data and the second column is a site index where the data come from. Second, `$\theta$` is a vector of numerical values where to evaluate the prior distribution. Finally, `niter` is an integer for the sample size in the MCMC that is used to evaluate unknown $\mu_i, \sigma^2_j$ at each site i ( i = 1, 2, 3 in our case). By default it is set to $10^5$, which is an effective sample size for MCMC. Users are free to choose a different sample size. 
Putting the data of the three sites into dataframe, we have:

```{r}
exdata_S1 = data.frame(val=c(2,4), site_id=rep('S1',2), type=c('bound.min','bound.max'))
exdata_S2 = data.frame(val=c(2,0.1), site_id=rep('S2',2), type=c('moment.1','moment.2'))
exdata_S3 = data.frame(val=c(2,3,4), site_id=rep('S3',3), type=c('meas','meas','meas'))
exdata_multitype <- rbind(exdata_S1, exdata_S2, exdata_S3)
exdata_multitype
theta = seq(from=-10, to=10, by=0.1)
```

Running `genExPrior` with these arguments, we attain the prior distribution for $\theta$ as well as the posterior hyperparameters of our Bayesian hierarchical model.

```{r}
resExPrior = genExPrior(exdata = exdata_multitype, theta = theta)
```

If the distribution of the parameter is not normal, `genExPrior` provides an option to transform the distribution to normal under user's choices. Two types of Johnson transformation, logarithm and log ratio, as well as Box-Cox transformation are provided. Lower and upper limit of log ratio, and value of $\lambda$ for Box-Cox transformation should be chosen so that the transformed data has normal distribution.

First, let us look at the posteriors of the hyperparameters, which are conditioned on the data in the `exdata` data frame. To that end, we use the function `plotHyperDist` with the results from `genExPrior` as input

```{r}
plotHyperDist(resExPrior)
```

Then, we can visualize both the uninformative and informative distribution of $\theta$ using `plotExPrior`. This function again takes as input the output from `genExPrior` as well as a Boolean asking whether to additionally plot the used data.

```{r}
plotExPrior(resExPrior)
```
  
<!-- # From the vignette generated by default -->

<!-- Vignettes are long form documentation commonly included in packages. Because they are part of the distribution of the package, they need to be as compact as possible. The `html_vignette` output type provides a custom style sheet (and tweaks some options) to ensure that the resulting html is as small as possible. The `html_vignette` format: -->

<!-- - Never uses retina figures -->
<!-- - Has a smaller default figure size -->
<!-- - Uses a custom CSS stylesheet instead of the default Twitter Bootstrap style -->

<!-- ## Vignette Info -->

<!-- Note the various macros within the `vignette` section of the metadata block above. These are required in order to instruct R how to build the vignette. Note that you should change the `title` field and the `\VignetteIndexEntry` to match the title of your vignette. -->

<!-- ## Styles -->

<!-- The `html_vignette` template includes a basic CSS theme. To override this theme you can specify your own CSS in the document metadata as follows: -->

<!--     output: -->
<!--       rmarkdown::html_vignette: -->
<!--         css: mystyles.css -->

<!-- ## Figures -->

<!-- The figure sizes have been customised so that you can easily put two images side-by-side. -->

<!-- ```{r, fig.show='hold'} -->
<!-- plot(1:10) -->
<!-- plot(10:1) -->
<!-- ``` -->

<!-- You can enable figure captions by `fig_caption: yes` in YAML: -->

<!--     output: -->
<!--       rmarkdown::html_vignette: -->
<!--         fig_caption: yes -->

<!-- Then you can use the chunk option `fig.cap = "Your figure caption."` in **knitr**. -->

<!-- ## More Examples -->

<!-- You can write math expressions, e.g. $Y = X\beta + \epsilon$, footnotes^[A footnote here.], and tables, e.g. using `knitr::kable()`. -->

<!-- ```{r, echo=FALSE, results='asis'} -->
<!-- knitr::kable(head(mtcars, 10)) -->
<!-- ``` -->

<!-- Also a quote using `>`: -->

<!-- > "He who gives up [code] safety for [code] speed deserves neither." -->
<!-- ([via](https://twitter.com/hadleywickham/status/504368538874703872)) -->
